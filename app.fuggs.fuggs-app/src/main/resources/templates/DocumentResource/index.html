{#include main.html}
{#title}Belege - Fuggs Buchhaltung{/title}

{#moreStyles}
<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--cds-spacing-05);
  }
  .page-header h1 {
    margin: 0;
  }
  .amount {
    font-weight: 600;
    font-family: 'IBM Plex Mono', monospace;
    text-align: right;
    display: block;
  }
  .bommel-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    background: #f4f4f4;
    border-radius: 0.75rem;
    font-size: 0.75rem;
  }
  .empty-state {
    text-align: center;
    padding: var(--cds-spacing-09);
    color: var(--cds-text-secondary);
  }
  .empty-state svg {
    width: 64px;
    height: 64px;
    margin-bottom: var(--cds-spacing-05);
    fill: var(--cds-icon-secondary, #525252);
  }
  a.cds-btn {
    height: 48px;
    padding: 0 1rem;
    border: none;
    font-size: 0.875rem;
    font-weight: 400;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
  }
  a.cds-btn-primary {
    background-color: #0f62fe;
    color: white;
  }
  a.cds-btn-primary:hover {
    background-color: #0353e9;
  }
  .privately-paid {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    background: #fff1f1;
    border-radius: 0.75rem;
    font-size: 0.75rem;
    color: #da1e28;
  }
  .has-file {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    background: linear-gradient(135deg, #d0e2ff 0%, #a6c8ff 100%);
    border-radius: 0.75rem;
    font-size: 0.75rem;
    color: #0043ce;
  }
  .has-file svg {
    width: 12px;
    height: 12px;
    fill: currentColor;
  }
  .tags-cell {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    max-width: 200px;
  }
  .tags-cell cds-tag {
    --cds-layout-size-height: 1.5rem;
  }
  .tags-cell cds-tag[type="purple"] {
    background: linear-gradient(135deg, rgba(105, 41, 196, 0.15) 0%, rgba(166, 108, 255, 0.2) 100%);
    border-color: #8a3ffc;
  }
  cds-table {
    width: 100%;
  }
  cds-table-cell a {
    color: var(--cds-link-primary, #0f62fe);
    text-decoration: none;
  }
  cds-table-cell a:hover {
    text-decoration: underline;
  }
  .status-cell {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  .extraction-source {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    background: linear-gradient(135deg, rgba(105, 41, 196, 0.15) 0%, rgba(166, 108, 255, 0.2) 100%);
    border-radius: 0.75rem;
    font-size: 0.75rem;
    color: #6929c4;
  }
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    border-radius: 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
    transition: all 0.2s ease;
  }
  .status-badge.uploaded {
    background-color: #e8daff;
    color: #6929c4;
  }
  .status-badge.analyzing {
    background-color: #d0e2ff;
    color: #0043ce;
  }
  .status-badge.analyzed {
    background-color: #a7f0ba;
    color: #0e6027;
  }
  a.status-badge.analyzed:hover {
    background-color: #6fdc8c;
    transform: translateX(3px);
    box-shadow: 0 2px 8px rgba(14, 96, 39, 0.2);
  }
  .status-badge.confirmed {
    background-color: #a7f0ba;
    color: #0e6027;
  }
  .status-badge.failed {
    background-color: #ffd7d9;
    color: #a2191f;
  }

  /* Transaction status badges */
  .transaction-status {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    border-radius: 0.75rem;
    font-size: 0.75rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s ease;
  }
  .transaction-status.has-transaction {
    background: linear-gradient(135deg, #defbe6 0%, #a7f0ba 100%);
    color: #0e6027;
    cursor: pointer;
  }
  .transaction-status.has-transaction:hover {
    background: linear-gradient(135deg, #a7f0ba 0%, #6fdc8c 100%);
    transform: translateX(3px);
    box-shadow: 0 2px 8px rgba(14, 96, 39, 0.2);
  }
  .transaction-status.no-transaction {
    background: linear-gradient(135deg, rgba(105, 41, 196, 0.15) 0%, rgba(166, 108, 255, 0.2) 100%);
    color: #6929c4;
  }
  .transaction-status svg {
    width: 12px;
    height: 12px;
    fill: currentColor;
  }

  /* Review Alert Banner */
  .review-alert {
    background: linear-gradient(135deg, #8a3ffc 0%, #6929c4 100%);
    color: white;
    padding: 1.5rem 2rem;
    border-radius: 8px;
    margin-bottom: var(--cds-spacing-05);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    box-shadow: 0 4px 12px rgba(105, 41, 196, 0.3);
    animation: slideIn 0.3s ease-out;
  }
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .review-alert-icon {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    animation: pulse 2s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% {
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4);
    }
    50% {
      transform: scale(1.05);
      box-shadow: 0 0 0 10px rgba(255, 255, 255, 0);
    }
  }
  .review-alert-icon svg {
    width: 24px;
    height: 24px;
    fill: white;
  }
  .review-alert-content {
    flex: 1;
  }
  .review-alert-content h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
  }
  .review-alert-content p {
    margin: 0;
    opacity: 0.95;
    font-size: 0.875rem;
  }
  .review-alert-actions {
    display: flex;
    gap: 0.75rem;
  }
  .review-btn {
    background: white;
    color: #6929c4;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .review-btn:hover {
    background: #f4f4f4;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }
  .review-btn svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
  }

  /* Make analyzed rows stand out */
  cds-table-row.needs-review {
    background: linear-gradient(90deg, rgba(105, 41, 196, 0.03) 0%, rgba(166, 108, 255, 0.05) 100%);
    animation: glow 3s ease-in-out infinite;
  }
  @keyframes glow {
    0%, 100% {
      box-shadow: inset 0 0 0 1px rgba(105, 41, 196, 0.1);
    }
    50% {
      box-shadow: inset 0 0 0 2px rgba(105, 41, 196, 0.2);
    }
  }
  .needs-review .status-badge.analyzed {
    animation: bounce 2s ease-in-out infinite;
  }
  @keyframes bounce {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-3px);
    }
  }

  /* Transaction Creation Alert Banner */
  .transaction-alert {
    background: linear-gradient(135deg, #0f62fe 0%, #0043ce 100%);
    color: white;
    padding: 1.5rem 2rem;
    border-radius: 8px;
    margin-bottom: var(--cds-spacing-05);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    box-shadow: 0 4px 12px rgba(15, 98, 254, 0.3);
    animation: slideIn 0.3s ease-out;
  }
  .transaction-alert-icon {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    animation: pulse 2s ease-in-out infinite;
  }
  .transaction-alert-icon svg {
    width: 24px;
    height: 24px;
    fill: white;
  }
  .transaction-alert-content {
    flex: 1;
  }
  .transaction-alert-content h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    font-weight: 600;
  }
  .transaction-alert-content p {
    margin: 0;
    opacity: 0.95;
    font-size: 0.875rem;
  }
  .transaction-btn {
    background: white;
    color: #0043ce;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    transition: all 0.2s;
    white-space: nowrap;
  }
  .transaction-btn:hover {
    background: #f4f4f4;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }
  .transaction-btn svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
  }
</style>
{/moreStyles}

<div class="page-header">
  <h1>Belege</h1>
  <cds-button href="/belege/neu" kind="primary">
    Neuer Beleg
    <svg slot="icon" viewBox="0 0 32 32" width="16" height="16" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2z"/></svg>
  </cds-button>
</div>

{#if !documentsNeedingReview.isEmpty}
<cds-actionable-notification
  kind="info"
  title="{#if documentsNeedingReview.size() == 1}ðŸŽ‰ Ein Beleg wartet auf Ihre PrÃ¼fung!{#else}ðŸŽ‰ {documentsNeedingReview.size()} Belege warten auf Ihre PrÃ¼fung!{/if}"
  subtitle="Die KI hat die Daten bereits extrahiert. Schauen Sie sie kurz durch und bestÃ¤tigen Sie sie mit einem Klick."
  low-contrast
  style="margin-bottom: var(--cds-spacing-05);">
  <cds-actionable-notification-button slot="action" onclick="window.location='/belege/{documentsNeedingReview.get(0).id}/pruefen'">
    {#if documentsNeedingReview.size() == 1}Jetzt prÃ¼fen{#else}Ersten prÃ¼fen{/if}
  </cds-actionable-notification-button>
</cds-actionable-notification>
{/if}

{#if !documentsNeedingTransaction.isEmpty}
<form id="create-transaction-form" method="POST" action="/belege/{documentsNeedingTransaction.get(0).id}/create-transaction" style="display: none;">
  {#authenticityToken /}
</form>
<cds-actionable-notification
  kind="info"
  title="{#if documentsNeedingTransaction.size() == 1}ðŸ’° Ein Beleg kann in eine Transaktion umgewandelt werden!{#else}ðŸ’° {documentsNeedingTransaction.size()} Belege kÃ¶nnen in Transaktionen umgewandelt werden!{/if}"
  subtitle="Diese Belege wurden geprÃ¼ft und sind bereit, in Ihre Buchhaltung Ã¼bernommen zu werden."
  low-contrast
  style="margin-bottom: var(--cds-spacing-05);">
  <cds-actionable-notification-button slot="action" onclick="document.getElementById('create-transaction-form').submit()">
    {#if documentsNeedingTransaction.size() == 1}Transaktion erstellen{#else}Erste erstellen{/if}
  </cds-actionable-notification-button>
</cds-actionable-notification>
{/if}

<div class="box">
  {#if documents.isEmpty}
    <div class="empty-state">
      <svg viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0 0 18 2H8a2 2 0 0 0-2 2v24a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V10a.91.91 0 0 0-.3-.7ZM18 4.4l5.6 5.6H18ZM24 28H8V4h8v6a2 2 0 0 0 2 2h6Z"/><path d="M10 22h12v2H10zM10 16h12v2H10z"/></svg>
      <p>Noch keine Belege vorhanden.</p>
      <cds-button href="/belege/neu" kind="primary">Ersten Beleg anlegen</cds-button>
    </div>
  {#else}
    <cds-table size="lg">
      <cds-table-head>
        <cds-table-header-row>
          <cds-table-header-cell>Name / Absender</cds-table-header-cell>
          <cds-table-header-cell>Datum</cds-table-header-cell>
          <cds-table-header-cell>Betrag</cds-table-header-cell>
          <cds-table-header-cell>Bommel</cds-table-header-cell>
          <cds-table-header-cell>Tags</cds-table-header-cell>
          <cds-table-header-cell>Status</cds-table-header-cell>
        </cds-table-header-row>
      </cds-table-head>
      <cds-table-body>
        {#for doc in documents}
        <cds-table-row class="{#if doc.documentStatus != null && doc.documentStatus.name == 'ANALYZED'}needs-review{/if}">
          <cds-table-cell>
            <a href="{#if doc.documentStatus != null && doc.documentStatus.name == 'ANALYZED'}/belege/{doc.id}/pruefen{#else}/belege/{doc.id}{/if}">
              {doc.displayName}
            </a>
          </cds-table-cell>
          <cds-table-cell>{doc.displayDate}</cds-table-cell>
          <cds-table-cell><span class="amount">{doc.displayTotal}</span></cds-table-cell>
          <cds-table-cell>
            {#if doc.bommel}
              <span class="bommel-badge">{doc.bommel.title}</span>
            {#else}
              <span style="color: var(--cds-text-disabled);">â€”</span>
            {/if}
          </cds-table-cell>
          <cds-table-cell>
            {#if doc.hasTags}
            <div class="tags-cell">
              {#for docTag in doc.documentTags}
              <cds-tag size="sm" type="{#if docTag.aiGenerated}purple{#else}gray{/if}" title="{#if docTag.aiGenerated}KI-generiert{#else}Manuell{/if}">
                {docTag.name}
              </cds-tag>
              {/for}
            </div>
            {#else}
              <span style="color: var(--cds-text-disabled);">â€”</span>
            {/if}
          </cds-table-cell>
          <cds-table-cell>
            <div class="status-cell">
              {#if doc.documentStatus}
                {#if doc.documentStatus.name == 'ANALYZED'}
                <a href="/belege/{doc.id}/pruefen" class="status-badge {doc.documentStatus.name.toLowerCase}" style="text-decoration: none; cursor: pointer;" title="Klicken zum PrÃ¼fen">
                  {doc.displayStatus} â†’
                </a>
                {#else}
                <span class="status-badge {doc.documentStatus.name.toLowerCase}">
                  {doc.displayStatus}
                </span>
                {/if}
              {/if}
              {#if doc.hasFile}
                <span class="has-file">
                  <svg viewBox="0 0 32 32"><path d="M25.7 9.3l-7-7A.91.91 0 0 0 18 2H8a2 2 0 0 0-2 2v24a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V10a.91.91 0 0 0-.3-.7ZM18 4.4l5.6 5.6H18ZM24 28H8V4h8v6a2 2 0 0 0 2 2h6Z"/></svg>
                  Datei
                </span>
              {/if}
              {#if doc.displayExtractionSource}
                <span class="extraction-source">{doc.displayExtractionSource}</span>
              {/if}
              {#if doc.privatelyPaid}
                <span class="privately-paid">Privat bezahlt</span>
              {/if}
              {#if doc.hasTransactions}
                <a href="/transaktionen?documentId={doc.id}" class="transaction-status has-transaction" title="ZugehÃ¶rige Transaktion(en) anzeigen">
                  <svg viewBox="0 0 32 32"><path d="M28 6H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2ZM4 24V8h24v16Z"/><path d="M16 12a4 4 0 1 0 4 4 4 4 0 0 0-4-4Zm0 6a2 2 0 1 1 2-2 2 2 0 0 1-2 2ZM6 12h2v2H6zM6 18h2v2H6zM24 12h2v2h-2zM24 18h2v2h-2z"/></svg>
                  {doc.displayTransactionCount}
                </a>
              {#else}
                <span class="transaction-status no-transaction" title="Noch keine Transaktion erstellt">
                  {doc.displayTransactionCount}
                </span>
              {/if}
            </div>
          </cds-table-cell>
        </cds-table-row>
        {/for}
      </cds-table-body>
    </cds-table>
  {/if}
</div>

{#if flash:success}
  <cds-inline-notification
    kind="success"
    title="Erfolg"
    subtitle="{flash:success}"
    style="position: fixed; bottom: 1rem; right: 1rem;">
  </cds-inline-notification>
{/if}

{#if flash:error}
  <cds-inline-notification
    kind="error"
    title="Fehler"
    subtitle="{flash:error}"
    style="position: fixed; bottom: 1rem; right: 1rem;">
  </cds-inline-notification>
{/if}

{/include}
