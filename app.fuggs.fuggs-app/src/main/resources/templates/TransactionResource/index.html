{#include main.html}
{#title}Transaktionen - Fuggs Buchhaltung{/title}

{#moreStyles}
<style>
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--cds-spacing-05);
  }
  .page-header h1 {
    margin: 0;
  }
  .amount {
    font-weight: 600;
    font-family: 'IBM Plex Mono', monospace;
    text-align: right;
    display: block;
  }
  .bommel-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    background: #f4f4f4;
    border-radius: 0.75rem;
    font-size: 0.75rem;
  }
  .empty-state {
    text-align: center;
    padding: var(--cds-spacing-09);
    color: var(--cds-text-secondary);
  }
  .empty-state svg {
    width: 64px;
    height: 64px;
    margin-bottom: var(--cds-spacing-05);
    fill: var(--cds-icon-secondary, #525252);
  }
  .empty-state h2 {
    margin-bottom: 0.5rem;
    color: var(--cds-text-primary);
  }
  .empty-state p {
    margin-bottom: var(--cds-spacing-05);
  }
  a.cds-btn {
    height: 48px;
    padding: 0 1rem;
    border: none;
    font-size: 0.875rem;
    font-weight: 400;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
  }
  a.cds-btn-primary {
    background-color: #0f62fe;
    color: white;
  }
  a.cds-btn-primary:hover {
    background-color: #0353e9;
  }
  .privately-paid {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.125rem 0.5rem;
    background: #fff1f1;
    border-radius: 0.75rem;
    font-size: 0.75rem;
    color: #da1e28;
  }
  .tags-cell {
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
    max-width: 200px;
  }
  .tags-cell cds-tag {
    --cds-layout-size-height: 1.5rem;
  }
  .tags-cell cds-tag[type="purple"] {
    background: linear-gradient(135deg, rgba(105, 41, 196, 0.15) 0%, rgba(166, 108, 255, 0.2) 100%);
    border-color: #8a3ffc;
  }
  cds-table {
    width: 100%;
  }
  cds-table-row {
    cursor: pointer;
  }
  cds-table-row:hover {
    background-color: var(--cds-background-hover, #e8e8e8);
  }
  .transaction-name {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }
  .sender-name {
    font-size: 0.75rem;
    color: var(--cds-text-secondary, #525252);
  }
</style>
{/moreStyles}

<div class="page-header">
  <h1>Transaktionen</h1>
  <cds-button href="/transaktionen/neu" kind="primary">
    Neue Transaktion
    <svg slot="icon" viewBox="0 0 32 32" width="16" height="16" fill="currentColor"><path d="M17 15V7h-2v8H7v2h8v8h2v-8h8v-2z"/></svg>
  </cds-button>
</div>

<div class="box">
  {#if transactions.isEmpty}
    <div class="empty-state">
      <svg viewBox="0 0 32 32"><path d="M28 6H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2ZM4 24V8h24v16Z"/><path d="M16 12a4 4 0 1 0 4 4 4 4 0 0 0-4-4Zm0 6a2 2 0 1 1 2-2 2 2 0 0 1-2 2ZM6 12h2v2H6zM6 18h2v2H6zM24 12h2v2h-2zM24 18h2v2h-2z"/></svg>
      <h2>Keine Transaktionen vorhanden</h2>
      <p>Erstellen Sie Ihre erste Transaktion oder konvertieren Sie einen Beleg.</p>
      <cds-button href="/transaktionen/neu" kind="primary">
        Neue Transaktion erstellen
      </cds-button>
    </div>
  {#else}
    <cds-table size="lg">
      <cds-table-head>
        <cds-table-header-row>
          <cds-table-header-cell>Name</cds-table-header-cell>
          <cds-table-header-cell>Beleg</cds-table-header-cell>
          <cds-table-header-cell>Datum</cds-table-header-cell>
          <cds-table-header-cell>Betrag</cds-table-header-cell>
          <cds-table-header-cell>Bommel</cds-table-header-cell>
          <cds-table-header-cell>Tags</cds-table-header-cell>
          <cds-table-header-cell>Privat</cds-table-header-cell>
        </cds-table-header-row>
      </cds-table-head>
      <cds-table-body>
        {#for t in transactions}
        <cds-table-row onclick="window.location='/transaktionen/{t.id}'">
          <cds-table-cell>
            <div class="transaction-name">
              <strong>{t.displayName}</strong>
              {#if t.senderName}
              <div class="sender-name">{t.senderName}</div>
              {/if}
            </div>
          </cds-table-cell>
          <cds-table-cell>
            {#if t.document}
            <a href="/belege/{t.document.id}" onclick="event.stopPropagation();">ðŸ“„ Beleg</a>
            {#else}
            <span style="color: var(--cds-text-disabled);">â€”</span>
            {/if}
          </cds-table-cell>
          <cds-table-cell>{t.displayDate}</cds-table-cell>
          <cds-table-cell><span class="amount">{t.displayTotal}</span></cds-table-cell>
          <cds-table-cell>
            {#if t.bommel}
              <span class="bommel-badge">{t.bommel.title}</span>
            {#else}
              <span style="color: var(--cds-text-disabled);">â€”</span>
            {/if}
          </cds-table-cell>
          <cds-table-cell>
            {#if t.hasTags}
            <div class="tags-cell">
              {#for tt in t.transactionTags}
              <cds-tag size="sm" type="{#if tt.aiGenerated}purple{#else}gray{/if}" title="{#if tt.aiGenerated}KI-generiert{#else}Manuell{/if}">
                {tt.name}
              </cds-tag>
              {/for}
            </div>
            {#else}
              <span style="color: var(--cds-text-disabled);">â€”</span>
            {/if}
          </cds-table-cell>
          <cds-table-cell>
            {#if t.privatelyPaid}
            <span class="privately-paid">Privat</span>
            {/if}
          </cds-table-cell>
        </cds-table-row>
        {/for}
      </cds-table-body>
    </cds-table>
  {/if}
</div>

{#if flash:success}
  <cds-inline-notification
    kind="success"
    title="Erfolg"
    subtitle="{flash:success}"
    style="position: fixed; bottom: 1rem; right: 1rem;">
  </cds-inline-notification>
{/if}

{#if flash:error}
  <cds-inline-notification
    kind="error"
    title="Fehler"
    subtitle="{flash:error}"
    style="position: fixed; bottom: 1rem; right: 1rem;">
  </cds-inline-notification>
{/if}

{/include}
