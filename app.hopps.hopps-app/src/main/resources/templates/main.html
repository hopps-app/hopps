<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{#insert title/}</title>

    <!-- Carbon Design System Gray 10 Theme -->
    <link rel="stylesheet" href="https://unpkg.com/@carbon/styles@1.59.0/css/styles.min.css">

    <!-- Hopps Custom Styles -->
    <link rel="stylesheet" href="/css/hopps-core.css">
    <link rel="stylesheet" href="/css/hopps-components.css">
    <link rel="stylesheet" href="/css/hopps-pages.css">

    <!-- Carbon Web Components -->
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/ui-shell.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/button.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/text-input.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/number-input.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/select.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/date-picker.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/checkbox.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/textarea.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/tile.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/tag.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/notification.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/tree-view.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/dropdown.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/ai-label.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/data-table.min.js"></script>
    <script type="module" src="https://1.www.s81c.com/common/carbon/web-components/tag/v2/latest/file-uploader.min.js"></script>

    {#insert moreStyles /}
    {#insert moreScripts /}
  </head>
  <body>
    {#include tags/header.html /}

    <cds-side-nav aria-label="Hauptnavigation" collapse-mode="fixed" expanded>
      <cds-side-nav-items>
        <cds-side-nav-link href="/" {#if inject:vertxRequest.path == '/'}active{/if}>
          Dashboard
          <svg slot="title-icon" viewBox="0 0 32 32"><path d="M16.61 2.21a1 1 0 0 0-1.24 0L1 13.42 2.24 15 4 13.55V26a2 2 0 0 0 2 2h20a2 2 0 0 0 2-2V13.55L29.76 15 31 13.42ZM18 26h-4v-8h4Zm2 0v-8a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v8H6V12.06l10-8.14 10 8.14V26Z"/></svg>
        </cds-side-nav-link>

        <cds-side-nav-divider></cds-side-nav-divider>

        <cds-side-nav-menu title="Organisation">
          <svg slot="title-icon" viewBox="0 0 32 32"><path d="M16,15h11c.5523,0,1-.4478,1-1v-7c0-.5523-.4477-1-1-1h-5l-.72-1.45c-.1711-.3395-.5199-.5527-.9-.55h-4.38c-.5523,0-1,.4477-1,1v4H6V2h-2v22c0,1.1025.897,2,2,2h9v3c0,.5522.4477,1,1,1h11c.5523,0,1-.4478,1-1v-7c0-.5523-.4477-1-1-1h-5l-.72-1.45c-.1711-.3395-.5199-.5527-.9-.55h-4.38c-.5523,0-1,.4477-1,1v4H6v-13h9v3c0,.5522.4477,1,1,1ZM17,6h2.76l.45.89.55,1.11h5.24v5h-9v-7ZM17,21h2.76l.45.89.55,1.11h5.24v5h-9v-7Z"/></svg>
          <cds-side-nav-menu-item href="/bommels" {#if inject:vertxRequest.path.startsWith('/bommels')}active{/if}>
            Bommels
          </cds-side-nav-menu-item>
        </cds-side-nav-menu>

        <cds-side-nav-divider></cds-side-nav-divider>

        <cds-side-nav-menu title="Stammdaten">
          <svg slot="title-icon" viewBox="0 0 32 32"><path d="M12 4a5 5 0 1 1-5 5 5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7 7 7 0 0 0-7-7ZM22 30h-2v-5a5 5 0 0 0-5-5H9a5 5 0 0 0-5 5v5H2v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7ZM22 4h10v2H22zM22 9h10v2H22zM22 14h7v2h-7z"/></svg>
          <cds-side-nav-menu-item href="/mitglieder" {#if inject:vertxRequest.path.startsWith('/mitglieder')}active{/if}>
            Mitglieder
          </cds-side-nav-menu-item>
          <cds-side-nav-menu-item href="#" disabled>
            Kategorien
          </cds-side-nav-menu-item>
        </cds-side-nav-menu>

        <cds-side-nav-divider></cds-side-nav-divider>

        <cds-side-nav-menu title="Finanzen">
          <svg slot="title-icon" viewBox="0 0 32 32"><path d="M28 6H4a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2ZM4 24V8h24v16Z"/><path d="M16 12a4 4 0 1 0 4 4 4 4 0 0 0-4-4Zm0 6a2 2 0 1 1 2-2 2 2 0 0 1-2 2ZM6 12h2v2H6zM6 18h2v2H6zM24 12h2v2h-2zM24 18h2v2h-2z"/></svg>
          <cds-side-nav-menu-item href="/belege" {#if inject:vertxRequest.path.startsWith('/belege')}active{/if}>
            Belege
          </cds-side-nav-menu-item>
          <cds-side-nav-menu-item href="/transaktionen" {#if inject:vertxRequest.path.startsWith('/transaktionen')}active{/if}>
            Transaktionen
          </cds-side-nav-menu-item>
        </cds-side-nav-menu>

        <cds-side-nav-divider></cds-side-nav-divider>

        <cds-side-nav-menu title="System">
          <svg slot="title-icon" viewBox="0 0 32 32"><path d="M28 16a12 12 0 0 0-.8-4.3l1.8-.7a14.2 14.2 0 0 1 0 10l-1.8-.7A12 12 0 0 0 28 16ZM16 28a12 12 0 0 1-4.3-.8l-.7 1.8a14.2 14.2 0 0 0 10 0l-.7-1.8A12 12 0 0 1 16 28ZM4 16a12 12 0 0 1 .8-4.3l-1.8-.7a14.2 14.2 0 0 0 0 10l1.8-.7A12 12 0 0 1 4 16ZM16 4a12 12 0 0 1 4.3.8l.7-1.8a14.2 14.2 0 0 0-10 0l.7 1.8A12 12 0 0 1 16 4Z"/><path d="M16 24a8 8 0 1 1 8-8 8 8 0 0 1-8 8Zm0-14a6 6 0 1 0 6 6 6 6 0 0 0-6-6Z"/></svg>
          <cds-side-nav-menu-item href="#" disabled>
            Einstellungen
          </cds-side-nav-menu-item>
          <cds-side-nav-menu-item href="#" disabled>
            Audit-Log
          </cds-side-nav-menu-item>
        </cds-side-nav-menu>
      </cds-side-nav-items>
    </cds-side-nav>

    <div class="app-container">
      <main class="content">
        <div class="content-inner">
          {#insert /}
        </div>
      </main>
    </div>

    <script>
      function toggleSideNav() {
        var sideNav = document.querySelector('cds-side-nav');
        if (sideNav) {
          sideNav.expanded = !sideNav.expanded;
        }
      }

      // Handle side-nav expand/collapse for content layout
      document.addEventListener('DOMContentLoaded', function() {
        var sideNav = document.querySelector('cds-side-nav');
        if (sideNav) {
          // Set initial state
          function updateLayout() {
            if (sideNav.expanded) {
              document.body.classList.add('side-nav-expanded');
            } else {
              document.body.classList.remove('side-nav-expanded');
            }
          }

          // Update on initial load
          updateLayout();

          // Watch for changes to the expanded attribute
          var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.attributeName === 'expanded') {
                updateLayout();
              }
            });
          });

          observer.observe(sideNav, { attributes: true });

          // Also listen for property changes (when set via JS)
          var originalExpanded = sideNav.expanded;
          Object.defineProperty(sideNav, '_expanded', {
            get: function() { return originalExpanded; },
            set: function(value) {
              originalExpanded = value;
              updateLayout();
            }
          });
        }
      });

      // Shared tag handling functionality
      function initTagHandling() {
        var tagContainer = document.getElementById('tagContainer');
        var tagsInput = document.getElementById('tagsInput');
        var newTagInput = document.getElementById('newTagInput');
        var addTagBtn = document.getElementById('addTagBtn');

        if (!tagContainer || !tagsInput || !newTagInput || !addTagBtn) return;

        // Handle filter tag close events
        tagContainer.addEventListener('cds-tag-closed', function(event) {
          var tag = event.target;
          var tagName = tag.dataset.tagName;
          if (tagName) {
            removeTagFromInput(tagName);
            tag.remove();
          }
        });

        // Handle adding new tags
        function addNewTag() {
          var tagName = newTagInput.value.trim().toLowerCase();
          if (!tagName) return;

          var existingTags = getTagsFromInput();
          if (existingTags.includes(tagName)) {
            newTagInput.value = '';
            return;
          }

          existingTags.push(tagName);
          tagsInput.value = existingTags.join(', ');

          var tagElement = document.createElement('cds-tag');
          tagElement.setAttribute('filter', '');
          tagElement.setAttribute('size', 'md');
          tagElement.setAttribute('type', 'gray');
          tagElement.setAttribute('data-tag-name', tagName);
          tagElement.setAttribute('title', 'Manuell hinzugefÃ¼gt');
          tagElement.textContent = tagName;
          tagContainer.appendChild(tagElement);

          newTagInput.value = '';
          newTagInput.focus();
        }

        addTagBtn.addEventListener('click', addNewTag);

        newTagInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            e.preventDefault();
            addNewTag();
          }
        });

        function getTagsFromInput() {
          var value = tagsInput.value.trim();
          if (!value) return [];
          return value.split(',').map(function(t) { return t.trim().toLowerCase(); }).filter(function(t) { return t.length > 0; });
        }

        function removeTagFromInput(tagName) {
          var tags = getTagsFromInput();
          tags = tags.filter(function(t) { return t !== tagName.toLowerCase(); });
          tagsInput.value = tags.join(', ');
        }
      }

      document.addEventListener('DOMContentLoaded', initTagHandling);
    </script>
  </body>
</html>
