#######################################
# Quarkus
#######################################
quarkus.banner.path=banner.txt
%dev.quarkus.http.port=8101
%prod.quarkus.management.enabled=true
quarkus.smallrye-openapi.store-schema-directory=target/openapi
app.hopps.fin.url=http://localhost:8102

quarkus.http.auth.permission.rest.paths=*
quarkus.http.auth.permission.rest.policy=authenticated
quarkus.http.auth.permission.organization.paths=/organization
quarkus.http.auth.permission.organization.policy=permit
quarkus.http.auth.permission.organization.methods=POST
quarkus.http.auth.permission.management.paths=/q*
quarkus.http.auth.permission.management.policy=permit
%dev.quarkus.http.cors.enabled=true
%dev.quarkus.http.cors.origins=/.*/

# Disable CSRF for REST API endpoints (using Bearer token auth)
# CSRF protection is not needed for REST APIs using Bearer tokens
# (CSRF attacks only work against cookie-based authentication)
quarkus.rest-csrf.enabled=false

########################################
# Database
########################################
# Dev Services automatically starts PostgreSQL via Testcontainers in dev mode
# No manual Docker Compose needed - Quarkus handles everything
%dev.quarkus.datasource.db-kind=postgresql

%dev.quarkus.flyway.enabled=true
%dev.quarkus.flyway.migrate-at-start=true
%dev.quarkus.flyway.baseline-on-migrate=true
%dev.quarkus.flyway.baseline-version=0.0.1

%test.quarkus.flyway.migrate-at-start=true
%test.quarkus.flyway.baseline-on-migrate=true
%test.quarkus.flyway.baseline-version=0.0.1
%test.quarkus.flyway.clean-at-start=true
%prod.quarkus.flyway.migrate-at-start=true
%prod.quarkus.flyway.baseline-on-migrate=true
%prod.quarkus.flyway.baseline-version=0.0.1

########################################
# Testdata Bootstrapper
########################################
# Testdata is now loaded via TestdataBootstrapper from YAML, not Flyway
%dev,test.app.hopps.testdata.enabled=true
%prod.app.hopps.testdata.enabled=false
app.hopps.testdata.location=testdata/testdata.yaml
%dev.quarkus.datasource.devservices.port=5678
%dev.quarkus.datasource.devservices.db-name=org
quarkus.default-locale=de-DE
%test.quarkus.default-locale=en-US

########################################
# Keycloak/auth
########################################
app.hopps.org.auth.default-role=Owner
app.hopps.org.auth.realm-name=quarkus

# Dev mode: use Docker Compose Keycloak for reliable auth
%dev.quarkus.keycloak.devservices.realm-path=quarkus-realm.json
# Admin client URL - dev uses fixed port, test auto-discovers from DevServices
%dev.quarkus.keycloak.devservices.port=8554
%dev.quarkus.keycloak.admin-client.server-url=http://localhost:${quarkus.keycloak.devservices.port}

quarkus.keycloak.devservices.realm-name=${app.hopps.org.auth.realm-name}

quarkus.keycloak.admin-client.enabled=true
quarkus.keycloak.admin-client.realm=master
quarkus.keycloak.admin-client.client-id=admin-cli
quarkus.keycloak.admin-client.username=admin
quarkus.keycloak.admin-client.password=admin
quarkus.keycloak.admin-client.grant-type=PASSWORD
quarkus.oidc.devui.web-client-timeout=20S
%prod.quarkus.keycloak.devservices.enabled=false
%dev.quarkus.security.auth.enabled-in-dev-mode=true
# gets the SecurityContext#getUserPrincipal()#getName from the email claim
quarkus.oidc.token.principal-claim=email

quarkus.smallrye-openapi.path=/q/openapi
quarkus.swagger-ui.path=/q/swagger-ui
quarkus.swagger-ui.always-include=true

######################################
# All REST-Clients
######################################
# Enables the application-layer protocol negotiation for TLS, which
# allows the rest clients to try and use HTTP/2.
quarkus.rest-client.alpn=true

#####################################
# REST-Client document AI (for DocumentAiClient)
#####################################
quarkus.rest-client.document-ai.url=${HOPPS_DOCUMENT_AI_SERVICE_URL:http://localhost:8100}
%dev,test.quarkus.rest-client.document-ai.url=http://localhost:8100
quarkus.rest-client.document-ai.connect-timeout=5000
quarkus.rest-client.document-ai.read-timeout=300000
#####################################
# REST-Client zugferd (for ZugFerdClient)
#####################################
quarkus.rest-client.zugferd.url=${HOPPS_ZUGFERD_SERVICE_URL:http://localhost:8103}
%dev,test.quarkus.rest-client.zugferd.url=http://localhost:8103
quarkus.rest-client.zugferd.connect-timeout=5000
quarkus.rest-client.zugferd.read-timeout=30000

######################################
# S3
######################################
bucket.name=documents
quarkus.s3.path-style-access=true
# Dev Services automatically starts LocalStack for S3 via Testcontainers in dev mode
# No manual Docker Compose needed for S3 - Quarkus handles everything
######################################
# Document caching
######################################
# keep at most this amount of items in memory - this is low because each entry might be multiple MB's in size.
quarkus.cache.caffeine.document-cache.maximum-size=50

%dev.quarkus.hibernate-orm.dev-ui.allow-hql=true
